<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Agent Knowledge Base</title>

<style>
body{font-family:Arial;margin:0;background:#f4f4f4}
header{background:#c40000;color:#fff;padding:15px;text-align:center;font-size:22px}
.container{max-width:900px;margin:auto;padding:15px}
.card{background:#fff;padding:15px;border-radius:12px;margin-bottom:12px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
input,textarea,select{width:100%;padding:10px;margin-top:8px;border-radius:8px;border:1px solid #ccc}
button{background:#c40000;color:#fff;border:none;padding:10px;border-radius:8px;margin-top:8px;cursor:pointer}
button.black{background:black}
.hidden{display:none}
.search-row{display:flex;gap:10px}
.dark{background:#111;color:#fff}
.dark .card{background:#1e1e1e}
mark{background:yellow}
.entry{border-bottom:1px solid #ddd;padding:10px 0}
.entry:last-child{border:none}
.small{font-size:12px;color:gray}
</style>
</head>
<body>

<header>Agent Knowledge Base</header>

<div class="container">

<!-- LOGIN -->
<div id="loginCard" class="card">
<h3>Admin Login</h3>
<input id="user" placeholder="Username">
<input id="pass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel" class="card hidden">
<button onclick="logout()" class="black" style="float:right">Logout</button>

<h3>Add Knowledge</h3>

<select id="category">
<option>General</option>
<option>Policies</option>
<option>Guides</option>
<option>FAQ</option>
<option>Technical</option>
</select>

<input id="title" placeholder="Title">

<textarea id="content" rows="6" placeholder="Paste knowledge here..."></textarea>

<button onclick="addKnowledge()">Save Knowledge</button>

<hr>
<h3>Stored Knowledge</h3>
<div id="knowledgeList"></div>
</div>

<!-- SEARCH AREA -->
<div class="card">
<h3>Agent Search</h3>
<div class="search-row">
<input id="searchInput" placeholder="Ask a question...">
<button onclick="searchKB()">Search</button>
</div>
<div id="searchResults"></div>
</div>

<button onclick="toggleDark()">Dark Mode</button>

</div>

<script>

// ðŸ” ADMIN LOGIN
const ADMIN_USER = "admin";
const ADMIN_HASH = "03ac674216f3e15c761ee1a5e255f067953623c8b388b4459e13f978d7c846f4";

let KB = JSON.parse(localStorage.getItem("KB") || "[]");

// SHA-256
async function hash(text){
const buffer = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(text));
return Array.from(new Uint8Array(buffer)).map(b=>b.toString(16).padStart(2,"0")).join("");
}

// LOGIN
async function login(){
if(user.value !== ADMIN_USER) return alert("Wrong username");

if(await hash(pass.value) === ADMIN_HASH){
sessionStorage.setItem("admin","1");
loginCard.classList.add("hidden");
adminPanel.classList.remove("hidden");
renderAdmin();
} else {
alert("Wrong password");
}
}

// AUTO LOGIN IF SESSION EXISTS
if(sessionStorage.getItem("admin")){
loginCard.classList.add("hidden");
adminPanel.classList.remove("hidden");
renderAdmin();
}

function logout(){
sessionStorage.clear();
location.reload();
}

// SAVE STORAGE
function save(){
localStorage.setItem("KB", JSON.stringify(KB));
}

// ADD KNOWLEDGE
function addKnowledge(){

if(!title.value.trim() || !content.value.trim()){
alert("Title and content required");
return;
}

KB.push({
title: title.value,
category: category.value,
content: content.value,
date: new Date().toLocaleString()
});

save();
renderAdmin();

title.value="";
content.value="";

alert("Knowledge Saved!");
}

// RENDER ADMIN LIST
function renderAdmin(){
knowledgeList.innerHTML = KB.map((k,i)=>`
<div class="entry">
<b>${k.title}</b> (${k.category})<br>
<div class="small">${k.date}</div>
<button onclick="deleteItem(${i})" style="background:black;margin-top:5px">Delete</button>
</div>
`).join("");
}

// DELETE
function deleteItem(i){
if(confirm("Delete this entry?")){
KB.splice(i,1);
save();
renderAdmin();
}
}

// SEARCH FUNCTION (SMART TEXT SEARCH)
function searchKB(){

const q = searchInput.value.toLowerCase().trim();
if(!q) return;

const results = KB.filter(k =>
k.title.toLowerCase().includes(q) ||
k.content.toLowerCase().includes(q) ||
k.category.toLowerCase().includes(q)
);

if(results.length === 0){
searchResults.innerHTML = "<div class='card'>No results found.</div>";
return;
}

searchResults.innerHTML = results.map(k=>{

let highlighted = k.content.replace(
new RegExp(q,"gi"),
m=>`<mark>${m}</mark>`
);

return `
<div class="card">
<b>${k.title}</b> (${k.category})<br><br>
${highlighted}
</div>
`;

}).join("");

}

// DARK MODE
function toggleDark(){
document.body.classList.toggle("dark");
}

</script>
</body>
</html>
